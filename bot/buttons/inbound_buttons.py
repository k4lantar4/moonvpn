"""
Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ inbound Ø¯Ø± ÙØ±Ø§ÛŒÙ†Ø¯ Ø®Ø±ÛŒØ¯
"""

from typing import List
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton

from db.models.panel import Panel
from db.models.inbound import Inbound


def get_panel_locations_keyboard(panels: List[Panel]) -> InlineKeyboardMarkup:
    """
    Ø³Ø§Ø®Øª Ú©ÛŒØ¨ÙˆØ±Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ Ù„ÙˆÚ©ÛŒØ´Ù† Ù¾Ù†Ù„â€ŒÙ‡Ø§
    """
    keyboard = []
    
    # Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù„ÙˆÚ©ÛŒØ´Ù†
    for panel in panels:
        keyboard.append([
            InlineKeyboardButton(
                text=f"{panel.flag_emoji} {panel.location_name}",
                callback_data=f"select_location:{panel.id}"
            )
        ])
    
    # Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª
    keyboard.append([
        InlineKeyboardButton(
            text="ðŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù„ÛŒØ³Øª Ù¾Ù„Ù†â€ŒÙ‡Ø§",
            callback_data="back_to_plans"
        )
    ])
    
    return InlineKeyboardMarkup(inline_keyboard=keyboard)


def get_inbounds_keyboard(inbounds: List[Inbound], panel_id: int, plan_id: int) -> InlineKeyboardMarkup:
    """
    Ø³Ø§Ø®Øª Ú©ÛŒØ¨ÙˆØ±Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ inbound
    """
    keyboard = []
    
    # Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ inbound
    for inbound in inbounds:
        # Ù†Ù…Ø§ÛŒØ´ ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¯Ø± ØµÙˆØ±Øª ÙˆØ¬ÙˆØ¯ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª
        client_info = ""
        if inbound.max_clients:
            client_info = f" ({inbound.client_count}/{inbound.max_clients})"
        
        keyboard.append([
            InlineKeyboardButton(
                text=f"{inbound.protocol.upper()}@{inbound.port}{client_info}",
                callback_data=f"select_inbound:{plan_id}:{panel_id}:{inbound.id}"
            )
        ])
    
    # Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª
    keyboard.append([
        InlineKeyboardButton(
            text="ðŸ”™ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù„ÛŒØ³Øª Ù„ÙˆÚ©ÛŒØ´Ù†â€ŒÙ‡Ø§",
            callback_data=f"back_to_locations:{plan_id}"
        )
    ])
    
    return InlineKeyboardMarkup(inline_keyboard=keyboard) 