# 🌙 MoonVPN – راهنمای سریع AI در Cursor IDE

**به‌روزرسانی**: 2025-04-21

**هدف**: مرور فوری قوانین برای کمک به اجرای صحیح وظایف در پروژه MoonVPN.

### 🚫 محدودیت‌های کلیدی
- **هرگز** فایل پایتون را مستقیم اجرا نکن (فقط `moonvpn` CLI)
- **هرگز** پکیج‌ها را سراسری نصب نکن (فقط Docker + Poetry)
- **هرگز** `.env` یا تنظیمات دائمی را بدون درخواست تغییر نده
- **هرگز** ساختار در `[project-structure.md](mdc:docs/project-structure.md)` را نشکن
- **هرگز** کد ناقص (`TODO` و...) در PR نگذار

### 📂 مستندات اصلی
- نیازمندی‌ها: `[project-requirements.md](mdc:docs/project-requirements.md)`  
- ساختار پوشه‌ها: `[project-structure.md](mdc:docs/project-structure.md)`  
- ساختار DB: `[database-structure.md](mdc:docs/database-structure.md)`  
- روابط سیستم: `[Project-relationships.md](mdc:docs/Project-relationships.md)`  

### 🏗️ معماری لایه‌ای
```
کاربر ↔ ربات تلگرام ↔ سرویس‌ها ↔ ریپوزیتوری‌ها ↔ پایگاه داده ↔ 3x-ui API
```

### ⚡ فرآیند سریع برای هر وظیفه
1. **درک**: مطالعه مستندات + بررسی درخواست کاربر  
2. **طرح**: طراحی ساده یا شبه‌کد (در صورت پیچیدگی)  
3. **اجرا**: کدنویسی در مسیر صحیح با الگوهای موجود  
4. **تست**: `moonvpn test` + `moonvpn restart`  
5. **گزارش**: خلاصه فارسی 🚀

### 📋 قوانین ماژول‌ها
- **ربات** (`bot/`): فقط ورودی بگیرد و سرویس صدا بزند  
- **سرویس‌ها** (`core/services/`): همه منطق بیزینس و هماهنگی  
- **ریپوزیتوری‌ها** (`db/repositories/`): هر دسترسی به مدل‌های `[db/models/]`  
- **مهاجرت**: همیشه با `moonvpn migrate` انجام شود  

### 🛠️ توسعه و تست
- **CLI**:
```bash
moonvpn up | down | restart | test | migrate
```
- **تست**: ایزوله، با موک و transaction rollback  
- **مهاجرت**: `moonvpn migrate generate "msg"` → بازبینی → `moonvpn migrate upgrade`

### 📢 ارتباط با محمدرضا
- فارسی و دوستانه 😊  
- کوتاه، مستقیم و هدفمند  
- از ایموجی‌ها برای فهم سریع استفاده کن ⭐

---

> **یادآوری**: همیشه قبل از هر تغییر، ساختار و الگوهای موجود را در `[project-structure.md](mdc:docs/project-structure.md)` مرور کن. 