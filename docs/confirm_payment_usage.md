# ๐งพ ุฑุงูููุง ุชุฃุฏ ุชุฑุงฺฉูุดโูุง (Confirm Payment)

ุงู ูุณุชูุฏ ุฑูุด ุงุณุชูุงุฏู ุงุฒ ุงุจุฒุงุฑ ุชุฃุฏ ุชุฑุงฺฉูุด ูพุฑุฏุงุฎุช ุฏุฑ MoonVPN ุฑุง ุชูุถุญ ูโุฏูุฏ.

## ๐ ูฺฏุงู ฺฉู

ุงุจุฒุงุฑ ุชุฃุฏ ุชุฑุงฺฉูุด (`confirm_payment`) ุจู ุดูุง ุงูฺฉุงู ูโุฏูุฏ ุชุฑุงฺฉูุดโูุง ูพุฑุฏุงุฎุช ุฑุง ุจู ุตูุฑุช ุฏุณุช ู ุงุฒ ุทุฑู ุฎุท ูุฑูุงู ุชุฃุฏ ฺฉูุฏ. ุงู ุนููุงุช:
- ูุถุนุช ุชุฑุงฺฉูุด ุฑุง ุจู `success` ุชุบุฑ ูโุฏูุฏ
- ููุฌูุฏ ฺฉู ูพูู ฺฉุงุฑุจุฑ ุฑุง ุงูุฒุงุด ูโุฏูุฏ
- ููุชูฺฉุดู ููุงุณุจ ุฑุง ุจุฑุง ฺฉุงุฑุจุฑ ู ุงุฏูู ุงุฑุณุงู ูโฺฉูุฏ

## ๐๏ธ ุฏุณุชูุฑ ุฎุท ูุฑูุงู

### ุชุฃุฏ ุจุง ุดูุงุณู ุชุฑุงฺฉูุด

ุจุฑุง ุชุฃุฏ ฺฉ ุชุฑุงฺฉูุด ุจุง ุดูุงุณู ุชุฑุงฺฉูุดุ ุงุฒ ุฏุณุชูุฑ ุฒุฑ ุงุณุชูุงุฏู ฺฉูุฏ:

```bash
moonvpn shell app
python -m core.scripts.confirm_payment --txn TRANSACTION_ID
```

### ุชุฃุฏ ุจุง ุดูุงุณู ุณูุงุฑุด

ุจุฑุง ุชุฃุฏ ุชุฑุงฺฉูุด ูุฑุชุจุท ุจุง ฺฉ ุณูุงุฑุดุ ุงุฒ ุฏุณุชูุฑ ุฒุฑ ุงุณุชูุงุฏู ฺฉูุฏ:

```bash
moonvpn shell app
python -m core.scripts.confirm_payment --order ORDER_ID
```

## ๐ ููููู ุงุณุชูุงุฏู

ุจุฑุง ุชุฃุฏ ุชุฑุงฺฉูุด ุจุง ุดูุงุณู `123`:

```bash
moonvpn shell app
python -m core.scripts.confirm_payment --txn 123
```

ุฎุฑูุฌ ูพุณ ุงุฒ ุงุฌุฑุง ูููู:

```
โ ุชุฑุงฺฉูุด 123 ุจุง ููููุช ุชุฃุฏ ุดุฏ.
๐ค ฺฉุงุฑุจุฑ 98765432
๐ฐ ูุจูุบ: 100000.00 ุชููุงู
```

## ๐ฑ ุณุณุชู ููุชูฺฉุดู

ูพุณ ุงุฒ ุชุฃุฏ ุชุฑุงฺฉูุดุ ุณุณุชู ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุฏู ููุชูฺฉุดู ุงุฑุณุงู ูโฺฉูุฏ:

1. **ุจู ฺฉุงุฑุจุฑ**: ุงุทูุงุนโุฑุณุงู ุฏุฑ ููุฑุฏ ุชุฃุฏ ุชุฑุงฺฉูุด ู ููุฌูุฏ ุฌุฏุฏ
2. **ุจู ุงุฏููโูุง**: ุงุทูุงุนโุฑุณุงู ุฏุฑ ููุฑุฏ ุชุฃุฏ ุชุฑุงฺฉูุด

### ุชุณุช ููุชูฺฉุดู

ุจุฑุง ุชุณุช ุณุณุชู ููุชูฺฉุดูุ ูโุชูุงูุฏ ุงุฒ ฺฉ ุงุฒ ุฑูุดโูุง ุฒุฑ ุงุณุชูุงุฏู ฺฉูุฏ:

#### 1. ุงุฒ ุทุฑู ุจุงุช ุชูฺฏุฑุงู (ุฏุฑ ุตูุฑุช ูุนุงู ุจูุฏู ุจุงุช)

ุฏุณุชูุฑ `/test_notify` ุฑุง ุฏุฑ ุจุงุช ุงุฑุณุงู ฺฉูุฏ ุชุง ฺฉ ูพุงู ุชุณุช ุฏุฑุงูุช ฺฉูุฏ.

#### 2. ุงุฒ ุทุฑู ุฎุท ูุฑูุงู

ูโุชูุงูุฏ ููุชูฺฉุดูโูุง ุฑุง ุจุง ุงุณฺฉุฑูพุช `test_notification.py` ุฏุฑ ูุญุท CLI ุชุณุช ฺฉูุฏ:

```bash
# ุงุฑุณุงู ููุชูฺฉุดู ุจู ฺฉุงุฑุจุฑ ูุดุฎุต
moonvpn shell app
python -m core.scripts.test_notification --user_id TELEGRAM_ID --message "ูพุงู ุชุณุช"

# ุงุฑุณุงู ููุชูฺฉุดู ุจู ููู ุงุฏููโูุง
python -m core.scripts.test_notification --user_id 123456789 --admin --message "ูพุงู ุชุณุช ุงุฏูู"

# ุงุฑุณุงู ููุชูฺฉุดู ุจู ฺฉุงูุงู
python -m core.scripts.test_notification --user_id 123456789 --channel --message "ูพุงู ุชุณุช ฺฉุงูุงู"
```

## โ ุชุณุช ู ุจุฑุฑุณ

ุจุฑุง ุงุทููุงู ุงุฒ ุนููฺฉุฑุฏ ุตุญุญ ุงู ูฺฺฏุ ููุงุฑุฏ ุฒุฑ ุฑุง ุจุฑุฑุณ ฺฉูุฏ:

1. **ุจุฑุฑุณ ุฏุชุงุจุณ**: ูพุณ ุงุฒ ุชุฃุฏ ูพุฑุฏุงุฎุชุ ุงุฒ ุทุฑู phpMyAdmin ุง ุฏุณุชุฑุณ ูุณุชูู ุจู ุฏุชุงุจุณุ ูุถุนุช ุชุฑุงฺฉูุด ู ููฺูู ุงูุฒุงุด ููุฌูุฏ ฺฉุงุฑุจุฑ ุฑุง ุจุฑุฑุณ ฺฉูุฏ:

```sql
-- ุจุฑุฑุณ ูุถุนุช ุชุฑุงฺฉูุด
SELECT * FROM transactions WHERE id = TRANSACTION_ID;

-- ุจุฑุฑุณ ููุฌูุฏ ฺฉุงุฑุจุฑ
SELECT id, telegram_id, balance FROM users WHERE id = USER_ID;
```

2. **ุจุฑุฑุณ ููุชูฺฉุดู**: ูพุณ ุงุฒ ุชุฃุฏ ูพุฑุฏุงุฎุชุ ฺฉุงุฑุจุฑ ุจุงุฏ ูพุงู ููุงุณุจ ุฏุฑุงูุช ฺฉูุฏ ฺฉู ุญุงู ูุจูุบ ูพุฑุฏุงุฎุช ู ููุฌูุฏ ูุนู ุงุณุช. ููฺูู ุงุฏููโูุง ุจุงุฏ ููุชูฺฉุดู ุชุฃุฏ ุฑุง ุฏุฑุงูุช ฺฉููุฏ.

## ๐ ูุฑุขูุฏ ฺฉุงูู

1. ุงุฏูู ฺฉ ุชุฑุงฺฉูุด ูพุฑุฏุงุฎุช ุฏุณุช ุฑุง ุฏุฑ ุณุณุชู ูุดุงูุฏู ูโฺฉูุฏ
2. ูพุณ ุงุฒ ุชุฃุฏ ูพุฑุฏุงุฎุช ูุงูุน (ูุซูุง ฺฉุงุฑุช ุจู ฺฉุงุฑุช)ุ ุงุฏูู ุฏุณุชูุฑ `confirm_payment` ุฑุง ุงุฌุฑุง ูโฺฉูุฏ
3. ุณุณุชู ุชุฑุงฺฉูุด ุฑุง ุชุฃุฏ ูโฺฉูุฏ ู ููุฌูุฏ ฺฉุงุฑุจุฑ ุฑุง ุงูุฒุงุด ูโุฏูุฏ
4. ฺฉุงุฑุจุฑ ฺฉ ููุชูฺฉุดู ุชุฃุฏ ูพุฑุฏุงุฎุช ุฏุฑุงูุช ูโฺฉูุฏ
5. ฺฉุงุฑุจุฑ ุงฺฉููู ูโุชูุงูุฏ ุงุฒ ููุฌูุฏ ุฎูุฏ ุจุฑุง ุฎุฑุฏ ุณุฑูุณ ุงุณุชูุงุฏู ฺฉูุฏ

## โ๏ธ ูฺฉุงุช ููู

- ุงู ุฏุณุชูุฑ ุฑุง ููุท ูพุณ ุงุฒ ุชุฃุฏ ูพุฑุฏุงุฎุช ูุงูุน ุงุฌุฑุง ฺฉูุฏ
- ุดูุงุณู ุชุฑุงฺฉูุด ุฑุง ุงุฒ ุทุฑู ุจุฎุด ูุฏุฑุช ุชุฑุงฺฉูุดโูุง ูพุฏุง ฺฉูุฏ
- ุจุฑุง ุงููุช ุจุดุชุฑุ ููุท ุงุฏููโูุง ุจุงุฏ ุฏุณุชุฑุณ ุงุฌุฑุง ุงู ุฏุณุชูุฑ ุฑุง ุฏุงุดุชู ุจุงุดูุฏ
- ุงฺฏุฑ ููุชูฺฉุดูโูุง ุจู ฺฉุงุฑุจุฑุงู ุงุฑุณุงู ููโุดูุฏุ ูุทูุฆู ุดูุฏ ฺฉู:
  - ุจุงุช ุชูฺฏุฑุงู ูุนุงู ุงุณุช
  - ุณุฑูุณ `notification_service` ุฏุฑ ูุงู `bot/main.py` ุจู ุฏุฑุณุช ุฑุงูโุงูุฏุงุฒ ุดุฏู ุงุณุช
  - ูุชุบุฑูุง ูุญุท `BOT_TOKEN` ู `ADMIN_IDS` ุจู ุฏุฑุณุช ุชูุธู ุดุฏูโุงูุฏ 