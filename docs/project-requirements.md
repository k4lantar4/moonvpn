# 📌 MoonVPN Project Requirements

## 🎯 اهداف پروژه
ساخت یک سیستم مدیریت فروش و مدیریت VPN از طریق ربات تلگرام، با قابلیت اتصال و کنترل پنل‌های XUI و ارائه سرویس به کاربران نهایی.

## 🏢 معماری لایه‌ای
پروژه بر اساس چهار لایه اصلی سازمان‌دهی شده است:
1.  **`bot`**: لایه تعامل با کاربر از طریق تلگرام (aiogram). شامل دستورات، پاسخ‌ها، مدیریت وضعیت و کیبوردها.
2.  **`core`**: هسته منطقی پروژه. شامل سرویس‌ها، اسکریپت‌ها (مانند تست اتصال پنل) و یکپارچه‌سازی‌ها (مانند `py3xui` برای تعامل با XUI).
3.  **`db`**: لایه مدیریت پایگاه‌داده (MySQL با SQLAlchemy و Alembic). شامل مدل‌ها، مخازن (Repositories) و اسکیم‌ها (Schemas).
4.  **`scripts/tests/docs`**: ابزارها و مستندات کمکی. شامل اسکریپت‌های کاربردی، تست‌ها و مستندات پروژه.

## ✨ ویژگی‌های اصلی
- **مدیریت پنل‌های XUI**:
    - ثبت و مدیریت چندین پنل XUI توسط ادمین.
    - امکان تست اتصال به پنل‌ها.
    - تعامل مستقیم با API پنل‌ها از طریق کتابخانه `py3xui`.
    - کنترل محدودیت تعداد کاربران در هر پنل.
- **مدیریت کاربران و سفارش‌ها**:
    - ثبت‌نام و احراز هویت کاربران از طریق ربات تلگرام.
    - تعریف پلن‌های مختلف (حجم، زمان، تعداد کاربر).
    - ثبت سفارش خرید پلن توسط کاربر.
    - سیستم مدیریت دسترسی‌های ادمین.
- **پرداخت و تایید**:
    - پرداخت از طریق کیف پول داخلی یا ارسال رسید کارت‌به‌کارت.
    - سیستم تأیید رسید توسط ادمین‌ها با قابلیت تایید خودکار.
    - محاسبه خودکار موجودی کیف پول.
    - تنظیمات پیشرفته پرداخت (حداقل و حداکثر مبلغ شارژ، مهلت ارسال رسید).
- **ساخت و تحویل اکانت**:
    - ساخت خودکار اکانت VPN در پنل XUI متناسب با پلن خریداری شده.
    - انتخاب inbound مناسب برای ساخت اکانت.
    - ارسال کانفیگ (لینک اشتراک، QR Code) به کاربر پس از تأیید سفارش.
    - مدیریت هوشمند ظرفیت پنل‌ها.
- **اطلاع‌رسانی و مدیریت**:
    - ارسال نوتیفیکیشن‌های وضعیت سفارش به کاربر و ادمین.
    - امکان مشاهده وضعیت اکانت‌ها توسط کاربر.
    - قابلیت‌های مدیریتی برای ادمین‌ها (مشاهده کاربران، سفارش‌ها، تراکنش‌ها، پنل‌ها).
    - گزارش‌گیری از عملکرد سیستم و وضعیت مالی.

## 🛠 ابزارها و تکنولوژی‌ها
- **زبان برنامه‌نویسی**: Python 3.10+
- **ربات تلگرام**: `aiogram 3.x`
- **پایگاه‌داده**: `MySQL 8.3+`
- **ORM و مایگریشن**: `SQLAlchemy 2.0+`, `Alembic`
- **تعامل با XUI**: `py3xui` (نسخه اختصاصی یا بهبودیافته)
- **مدیریت وابستگی‌ها**: `Poetry`
- **کانتینرسازی**: `Docker`, `docker-compose`

## ❌ موارد حذف شده یا تغییر یافته
- اسکریپت `moonvpn.sh` (مدیریت محیط از طریق Docker و Poetry انجام می‌شود).
- مفهوم "نماینده" (در حال حاضر پیاده‌سازی نشده).
- تولید QR اختصاصی با شخصی‌سازی ظاهر (QR استاندارد تولید می‌شود).
- OCR هوشمند (در حال حاضر به صورت محدود پیاده‌سازی شده).
- پشتیبانی از TProxy (تمرکز فعلی بر پروتکل‌های رایج XUI است).
- لوکیشن پویا توسط کاربر (لوکیشن در زمان خرید پلن تعیین می‌شود).

## 🆕 ویژگی‌های جدید
- سیستم کیف پول داخلی با امکان شارژ و خرید
- مدیریت دسترسی‌های ادمین با سطوح مختلف
- تنظیمات پیشرفته پرداخت و تایید رسید
- مدیریت هوشمند ظرفیت پنل‌ها
- گزارش‌گیری پیشرفته از عملکرد سیستم

