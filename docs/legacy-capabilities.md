# 📜 legacy-capabilities.md

این فایل شامل لیست قابلیت‌های مهم و ساختار ربات قدیمی است که برای طراحی دقیق بخش ادمین، کلاینت‌ها و پلن‌ها در پروژه جدید MoonVPN قابل استفاده است.

## 👥 امکانات کاربران

- مشاهده و خرید پلن‌ها:
  - دستور `/buy` یا دکمه “🛍 خرید سرویس”
  - نمایش سرورها (لوکیشن‌ها) با پرچم و عنوان
  - نمایش دسته‌بندی‌های هر سرور و سپس پلن‌ها
  - تایید نهایی و ثبت سفارش در جدول `fl_order`

- مشاهده اطلاعات سرویس خریداری‌شده:
  - نام اکانت، وضعیت، پورت، حجم کل، مصرف‌شده، باقی‌مانده
  - روزهای باقیمانده تا انقضا + تاریخ شمسی
  - نمایش کانفیگ نهایی و لینک

- ثبت لینک برای بررسی:
  - ورودی لینک کانفیگ → بررسی وضعیت یا تغییرات

- تغییر لوکیشن سرویس:
  - بررسی ظرفیت سرورها
  - نمایش سرورهای مجاز برای انتقال
  - بروزرسانی اطلاعات order

---

## 🧑‍💼 امکانات ادمین

- افزودن سرور جدید:
  - نام، ظرفیت، ریمارک انگلیسی، پرچم
  - ذخیره در `fl_server`

- حذف و ویرایش سرور:
  - بر اساس دستوراتی مانند `/delsrv{id}` و `/editsrv{id}`

- تعریف دسته‌بندی برای سرورها:
  - افزودن، حذف، ویرایش عنوان دسته‌ها در `fl_cat`

- تعریف پلن (سرویس آماده):
  - ساخت پلن با ساختار `vmess-30-100-1-20-1`
    - نوع پروتکل، روز، حجم، آیدی اینباند، ظرفیت، مولتی‌یوزر
  - ذخیره اطلاعات در `fl_file`

- تعریف نماینده یا همکار فروش:
  - ارسال عددی + درصد
  - ثبت در جدول `fl_sellers`

- کپی‌کردن همه پلن‌ها از یک سرور به دیگری

- نمایش وضعیت کلی اکانت:
  - مصرف، باقی‌مانده، وضعیت فعال بودن، تاریخ انقضا

---

## 🧪 اکانت تست

- ساخت اکانت تست با شرایط محدود (روز یا حجم)
- ورود لاگ تست در جدول `test_account_log`
- استفاده از ساختار مشابه ساخت اکانت عادی

---

## 🔁 تعامل با پنل X-UI

- فراخوانی اینباندها با `get_inbounds`
- ایجاد اکانت بر اساس مشخصات سرویس
- دریافت ترافیک کلاینت‌ها
- ریست ترافیک
- دریافت لینک اتصال (کانفیگ)
- مدیریت حذف/ویرایش/تمدید سرویس‌ها

---

## 🧠 نکات ساختاری مهم

- مقداردهی به ریمارک باید انگلیسی و بدون فاصله باشد
- پشتیبانی از پلن با ترافیک محدود و نامحدود
- قابلیت ثبت remark سفارشی توسط کاربر
- دسته‌بندی پلن‌ها برای نمایش مرتب‌تر
- تطبیق زمان انقضا و حجم با فرمت تقویم شمسی برای کاربر
