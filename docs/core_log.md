# گزارش تحلیلی هسته (core) پروژه MoonVPN 🚀

## ساختار پوشه‌ها و فایل‌های هسته

- **core/services/**: شامل سرویس‌های اصلی کسب‌وکار (کاربران، پرداخت، کیف پول، سفارش، پنل، اکانت، اعلان و ...)
- **core/integrations/**: تعامل با سرویس‌های خارجی (مثلاً xui_client)
- **core/scripts/**: اسکریپت‌های راه‌اندازی و داده اولیه (seed)
- **core/settings.py**: تنظیمات ثابت پروژه (توکن‌ها، شناسه‌ها، تنظیمات دیتابیس)
- **core/log_config.py**: پیکربندی لاگینگ مرکزی
- **core/__init__.py**: تعریف ماژول هسته

---

## تنظیمات هسته (core/settings.py)

- بارگذاری متغیرهای محیطی با dotenv
- تعریف شناسه ادمین‌ها و کانال تلگرام
- توکن بات تلگرام
- قالب نام‌گذاری اکانت‌ها
- محدودیت و تنظیمات حساب تست
- تنظیمات اتصال به دیتابیس (MySQL با درایور aiomysql)
- اطمینان از استفاده از درایور صحیح

**نکته:** تنظیمات به صورت ماژولار و قابل توسعه پیاده‌سازی شده و از متغیرهای محیطی برای امنیت و انعطاف‌پذیری استفاده می‌شود.

---

## پیکربندی لاگینگ (core/log_config.py)

- استفاده از ماژول logging پایتون
- تعریف logger مرکزی با نام "moonvpn" و سطح DEBUG
- خروجی لاگ به صورت StreamHandler با فرمت زمانی و سطح لاگ
- مناسب برای دیباگ و مانیتورینگ در محیط توسعه و تولید

---

## سرویس مدیریت کاربران (core/services/user_service.py)

### وظایف اصلی:
- ثبت‌نام و دریافت اطلاعات کاربر بر اساس آیدی تلگرام
- بررسی ثبت‌نام بودن کاربر
- تشخیص نقش ادمین
- بروزرسانی نام کاربری و اطلاعات کاربر
- ایجاد کاربر جدید با اطلاعات کامل

### نکات فنی:
- استفاده از async و SQLAlchemy برای عملکرد بهینه و مقیاس‌پذیر
- جداسازی منطق کسب‌وکار از لایه داده (UserRepository)
- مدیریت تراکنش و خطاها با commit/rollback
- رعایت اصول کدنویسی تمیز و قابل نگهداری

---

## جمع‌بندی اولیه
- ساختار هسته پروژه ماژولار و قابل توسعه است.
- تنظیمات و لاگینگ به صورت استاندارد و امن پیاده‌سازی شده‌اند.
- سرویس کاربران با رعایت اصول SOLID و جداسازی لایه‌ها توسعه یافته است.

### مرحله بعد: تحلیل سایر سرویس‌های core/services و مستندسازی آن‌ها (در صورت تایید محمدرضا)

---

> این گزارش به صورت مرحله‌ای تکمیل خواهد شد. لطفاً برای ادامه تحلیل سرویس‌ها و سایر بخش‌ها، تایید فرمایید. 😊 